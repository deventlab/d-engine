# D-Engine Bench
## Test based on d-engine v0.1.2,
Please note, under v0.1.2, the snapshot feature still missing. So this is not the final performance report.
I suggest you wait for v0.2.0 for final performance report.

## Testing ENV
Mac mini with an Apple M2 chip. All three d-engine nodes are running on this single Mac mini, and the benchmark is also executed on the same machine.

Model Name: Mac mini
Model Identifier: Mac14,3
Model Number: Z16L0002TCH/A
Chip: Apple M2
Total Number of Cores: 8 (4 performance cores and 4 efficiency cores)
Memory: 16 GB

### Put 
```bash
./target/release/d-engine-bench  \
    --endpoints http://127.0.0.1:9081 --endpoints http://127.0.0.1:9082 --endpoints http://127.0.0.1:9083 \
    --conns 1 \
    --clients 1 \
    --sequential-keys  \
    --total 10000 \
    --key-size 8 \
    --value-size 256 \
    put

Summary:
Total time:	23.12 s
 Requests:	10000
Throughput:	432.49 ops/sec

Latency distribution (μs):
 Avg	2311.28
 Min	662
 Max	14143
 p50	2171
 p90	3151
 p99	3903
 p99.9	5551
```

### Put 
```bash
./target/release/d-engine-bench  \
    --endpoints http://127.0.0.1:9081 --endpoints http://127.0.0.1:9082 --endpoints http://127.0.0.1:9083 \
    --conns 10 \
    --clients 100 \
    --sequential-keys  \
    --total 10000 \
    --key-size 8 \
    --value-size 256 \
    put

Summary:
Total time:	2.63 s
 Requests:	10099
Throughput:	3846.82 ops/sec

Latency distribution (μs):
 Avg	2597.51
 Min	490
 Max	5511
 p50	2467
 p90	3797
 p99	4435
 p99.9	4827
 ```

 ### Linear Read
```bash

./target/release/d-engine-bench \
    --endpoints http://127.0.0.1:9081 \
    --endpoints http://127.0.0.1:9082 \
    --endpoints http://127.0.0.1:9083 \
    --conns 10 \
    --clients 100 \
    --sequential-keys \
    --total 10000 \
    --key-size 8 \
    range --consistency l

Summary:
Total time:	1.46 s
 Requests:	10099
Throughput:	6928.43 ops/sec

Latency distribution (μs):
 Avg	1438.74
 Min	746
 Max	3519
 p50	1398
 p90	1682
 p99	2181
 p99.9	3087

```

### Sequential Read(No consistence promise)

```bash
./target/release/d-engine-bench \
    --endpoints http://127.0.0.1:9081 \
    --endpoints http://127.0.0.1:9082 \
    --endpoints http://127.0.0.1:9083 \
    --conns 10 \
    --clients 100 \
    --sequential-keys \
    --total 10000 \
    --key-size 8 \
    range --consistency s

Total time:	0.50 s
 Requests:	10099
Throughput:	20036.55 ops/sec

Latency distribution (μs):
 Avg	496.41
 Min	95
 Max	7171
 p50	450
 p90	780
 p99	1255
 p99.9	2279  

```


# Etcd Bench

# Etcd benchmark 
## start etcd cluster
(https://github.com/etcd-io/etcd/tree/main/tools/benchmark)
>$ cd etcd_benchmark

etcd --name infra0 --initial-advertise-peer-urls http://0.0.0.0:2380 \
  --listen-peer-urls http://0.0.0.0:2380 \
  --listen-client-urls http://0.0.0.0:12379,http://127.0.0.1:12379 \
  --advertise-client-urls http://0.0.0.0:12379 \
  --initial-cluster-token etcd-cluster-1 \
  --initial-cluster infra0=http://0.0.0.0:2380,infra1=http://0.0.0.0:2381,infra2=http://0.0.0.0:2382 \
  --initial-cluster-state new

etcd --name infra1 --initial-advertise-peer-urls http://0.0.0.0:2381 \
  --listen-peer-urls http://0.0.0.0:2381 \
  --listen-client-urls http://0.0.0.0:22379,http://127.0.0.1:22379 \
  --advertise-client-urls http://0.0.0.0:22379 \
  --initial-cluster-token etcd-cluster-1 \
  --initial-cluster infra0=http://0.0.0.0:2380,infra1=http://0.0.0.0:2381,infra2=http://0.0.0.0:2382 \
  --initial-cluster-state new

etcd --name infra2 --initial-advertise-peer-urls http://0.0.0.0:2382 \
  --listen-peer-urls http://0.0.0.0:2382 \
  --listen-client-urls http://0.0.0.0:32379,http://127.0.0.1:32379 \
  --advertise-client-urls http://0.0.0.0:32379 \
  --initial-cluster-token etcd-cluster-1 \
  --initial-cluster infra0=http://0.0.0.0:2380,infra1=http://0.0.0.0:2381,infra2=http://0.0.0.0:2382 \
  --initial-cluster-state new

## Start benchmark script
### Install benchmark
Enter the directory and install the benchmark tool
> $cd etcd
> $go install -v ./tools/benchmark
### Run benchmark


### Put 
```shell
export ENDPOINTS=http://0.0.0.0:2380,http://0.0.0.0:2381,http://0.0.0.0:2382


/Users/joshua/go/bin/benchmark --endpoints=${ENDPOINTS} --target-leader  --conns=1 --clients=1 put --key-size=8 --sequential-keys --total=10000 --val-size=256

2025/04/19 13:31:20 INFO: [core] [Channel #7]Channel Connectivity change to READY
10000 / 10000 [----------------------------------------------------------------------------------------------------] 100.00% 158 p/s

Summary:
  Total:	63.6170 secs.
  Slowest:	0.0558 secs.
  Fastest:	0.0020 secs.
  Average:	0.0064 secs.
  Stddev:	0.0026 secs.
  Requests/sec:	157.1907

Response time histogram:
  0.0020 [1]	|
  0.0074 [8134]	|∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎
  0.0127 [1501]	|∎∎∎∎∎∎∎
  0.0181 [311]	|∎
  0.0235 [41]	|
  0.0289 [8]	|
  0.0342 [2]	|
  0.0396 [0]	|
  0.0450 [1]	|
  0.0504 [0]	|
  0.0558 [1]	|

Latency distribution:
  10% in 0.0039 secs.
  25% in 0.0049 secs.
  50% in 0.0060 secs.
  75% in 0.0070 secs.
  90% in 0.0089 secs.
  95% in 0.0112 secs.
  99% in 0.0167 secs.
  99.9% in 0.0247 secs.
```

### Put 
```shell
export ENDPOINTS=http://0.0.0.0:2380,http://0.0.0.0:2381,http://0.0.0.0:2382


/Users/joshua/go/bin/benchmark --endpoints=${ENDPOINTS} --target-leader  --conns=10 --clients=100 put --key-size=8 --sequential-keys --total=10000 --val-size=256

2025/04/19 13:34:05 INFO: [core] [Channel #33]Channel Connectivity change to READY
10000 / 10000 [---------------------------------------------------------------------------------------------------] 100.00% 6882 p/s

Summary:
  Total:	1.6534 secs.
  Slowest:	0.0381 secs.
  Fastest:	0.0055 secs.
  Average:	0.0164 secs.
  Stddev:	0.0047 secs.
  Requests/sec:	6048.1040

Response time histogram:
  0.0055 [1]	|
  0.0087 [91]	|∎
  0.0120 [1607]	|∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎
  0.0153 [2467]	|∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎
  0.0185 [3106]	|∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎
  0.0218 [1747]	|∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎
  0.0251 [504]	|∎∎∎∎∎∎
  0.0283 [256]	|∎∎∎
  0.0316 [125]	|∎
  0.0349 [95]	|∎
  0.0381 [1]	|

Latency distribution:
  10% in 0.0109 secs.
  25% in 0.0129 secs.
  50% in 0.0165 secs.
  75% in 0.0189 secs.
  90% in 0.0217 secs.
  95% in 0.0250 secs.
  99% in 0.0313 secs.
  99.9% in 0.0340 secs.
```

### Linear Read
```shell
export ENDPOINTS=http://0.0.0.0:2380,http://0.0.0.0:2381,http://0.0.0.0:2382


/Users/joshua/go/bin/benchmark --endpoints=${ENDPOINTS}  --conns=10 --clients=100  \
range key_  --consistency=l --total=10000 

2025/04/19 13:43:07 INFO: [core] [Channel #27]Channel Connectivity change to READY
10000 / 10000 [------------------------------------------------------------------------------------------------------] 100.00% ? p/s

Summary:
  Total:	0.1157 secs.
  Slowest:	0.0045 secs.
  Fastest:	0.0002 secs.
  Average:	0.0011 secs.
  Stddev:	0.0006 secs.
  Requests/sec:	86419.4063

Response time histogram:
  0.0002 [1]	|
  0.0006 [1227]	|∎∎∎∎∎∎∎∎∎∎∎
  0.0010 [4336]	|∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎
  0.0015 [2580]	|∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎
  0.0019 [851]	|∎∎∎∎∎∎∎
  0.0023 [524]	|∎∎∎∎
  0.0027 [256]	|∎∎
  0.0032 [160]	|∎
  0.0036 [50]	|
  0.0040 [11]	|
  0.0045 [4]	|

Latency distribution:
  10% in 0.0006 secs.
  25% in 0.0008 secs.
  50% in 0.0010 secs.
  75% in 0.0013 secs.
  90% in 0.0019 secs.
  95% in 0.0023 secs.
  99% in 0.0030 secs.
  99.9% in 0.0037 secs.
```

### Sequential Read(No consistence promise)

```shell
export ENDPOINTS=http://0.0.0.0:2380,http://0.0.0.0:2381,http://0.0.0.0:2382


/Users/joshua/go/bin/benchmark --endpoints=${ENDPOINTS}  --conns=10 --clients=100  \
range key_  --consistency=s --total=10000 

2025/04/19 13:55:20 INFO: [core] [Channel #24]Channel Connectivity change to READY
10000 / 10000 [------------------------------------------------------------------------------------------------------] 100.00% ? p/s

Summary:
  Total:	0.0872 secs.
  Slowest:	0.0113 secs.
  Fastest:	0.0000 secs.
  Average:	0.0008 secs.
  Stddev:	0.0010 secs.
  Requests/sec:	114635.3521

Response time histogram:
  0.0000 [1]	|
  0.0012 [8553]	|∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎∎
  0.0023 [1159]	|∎∎∎∎∎
  0.0034 [174]	|
  0.0045 [13]	|
  0.0057 [0]	|
  0.0068 [0]	|
  0.0079 [21]	|
  0.0090 [40]	|
  0.0102 [25]	|
  0.0113 [14]	|

Latency distribution:
  10% in 0.0003 secs.
  25% in 0.0004 secs.
  50% in 0.0006 secs.
  75% in 0.0008 secs.
  90% in 0.0015 secs.
  95% in 0.0019 secs.
  99% in 0.0075 secs.
  99.9% in 0.0105 secs.
```

## Summary

| Metric              | D-Engine (v0.1.2) | etcd            | Winner   |
|---------------------|-------------------|------------------|----------|
| Write Throughput    | 3,846 ops/sec     | 6,048 ops/sec    | etcd     |
| Linear Read Throughput | 6,928 ops/sec     | 86,419 ops/sec   | etcd     |
| Non-linearizable Read Throughput | 20,036 ops/sec    | 114,635 ops/sec | etcd     |
| Write Latency (p99) | 4.4 ms            | 31.3 ms          | D-Engine |
| Linear Read Latency (p99) | 2.1 ms            | 3.0 ms            | D-Engine |
