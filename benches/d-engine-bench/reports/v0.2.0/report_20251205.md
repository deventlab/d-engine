# d-engine v0.2.0 Performance Benchmark Report

**Date:** December 5, 2025  
**Hardware:** Apple Mac mini M2 (8-core, 16GB) - Single machine, 3-node cluster

---

## Performance Comparison: v0.2.0 vs v0.1.4

> **Important**: All v0.1.4 baselines were re-measured on 2025-12-05 to ensure accurate comparison.

| Test                       | v0.2.0        | v0.1.4 (remeasured) | Change     |
| -------------------------- | ------------- | ------------------- | ---------- |
| **Single client write**    | 553 ops/s     | 522 ops/s           | ✅ **+6%** |
| **High concurrency write** | 67,127 ops/s  | 66,003 ops/s        | ✅ **+2%** |
| **Linearizable read**      | 11,948 ops/s  | 12,127 ops/s        | ✅ -1.5%   |
| **LeaseRead**              | 92,239 ops/s  | 92,191 ops/s        | ✅ ~0%     |
| **EventualConsistency**    | 115,471 ops/s | 116,503 ops/s       | ✅ -0.9%   |

### Latency Comparison (p99)

| Test                   | v0.2.0 p99 | v0.1.4 p99 |
| ---------------------- | ---------- | ---------- |
| Single client write    | 2.26 ms    | 3.62 ms    |
| High concurrency write | 5.92 ms    | 5.91 ms    |
| Linearizable read      | 25.01 ms   | 24.26 ms   |
| LeaseRead              | 4.74 ms    | 5.55 ms    |
| EventualConsistency    | 8.67 ms    | 8.10 ms    |

---

## Summary

**v0.2.0 has NO performance regression compared to v0.1.4.**

Key findings:

- Write performance **improved by 2-6%**
- Read performance stable (within 1.5% margin)
- Watch mechanism optimization (#194) successfully eliminated overhead

---

## New Features in v0.2.0

| Feature                | Ticket | Description                             |
| ---------------------- | ------ | --------------------------------------- |
| TTL Support            | #172   | Key expiration with background cleanup  |
| Watch Mechanism        | #174   | Real-time key change notifications      |
| **Watch Optimization** | #194   | Skip protobuf decoding when no watchers |
| Single-node Cluster    | #179   | Dynamic expansion from 1→3 nodes        |
| EmbeddedEngine API     | #182   | Leader election notification support    |
| --key-space bench      | #193   | Hot-key testing for benchmarks          |

---

## New Feature: --key-space (Hot-Key Testing)

| Test                             | Throughput   | Avg Latency | p99      |
| -------------------------------- | ------------ | ----------- | -------- |
| Linearizable read (key-space=10) | 11,683 ops/s | 17.11 ms    | 26.61 ms |

> Same performance as sequential keys, confirming no caching effects in linearizable reads.

---

## Test Commands

```bash
# 1. Single client write (baseline: 622 ops/s)
./target/release/d-engine-bench \
    --endpoints http://127.0.0.1:9081 --endpoints http://127.0.0.1:9082 --endpoints http://127.0.0.1:9083 \
    --conns 1 --clients 1 --sequential-keys --total 100000 \
    --key-size 8 --value-size 256 put

# 2. High concurrency write (baseline: 67,303 ops/s)
./target/release/d-engine-bench \
    --endpoints http://127.0.0.1:9081 --endpoints http://127.0.0.1:9082 --endpoints http://127.0.0.1:9083 \
    --conns 200 --clients 1000 --sequential-keys --total 100000 \
    --key-size 8 --value-size 256 put

# 3. Linearizable read (baseline: 11,921 ops/s)
./target/release/d-engine-bench \
    --endpoints http://127.0.0.1:9081 --endpoints http://127.0.0.1:9082 --endpoints http://127.0.0.1:9083 \
    --conns 200 --clients 1000 --sequential-keys --total 200000 \
    --key-size 8 range --consistency l

# 4. Lease-based read (baseline: 98,455 ops/s)
./target/release/d-engine-bench \
    --endpoints http://127.0.0.1:9081 --endpoints http://127.0.0.1:9082 --endpoints http://127.0.0.1:9083 \
    --conns 200 --clients 1000 --sequential-keys --total 200000 \
    --key-size 8 range --consistency s

# 5. Eventual consistency read (baseline: 122,506 ops/s)
./target/release/d-engine-bench \
    --endpoints http://127.0.0.1:9081 --endpoints http://127.0.0.1:9082 --endpoints http://127.0.0.1:9083 \
    --conns 200 --clients 1000 --sequential-keys --total 200000 \
    --key-size 8 range --consistency e

# 6. [NEW] Hot-key test with --key-space (no baseline, new feature #193)
./target/release/d-engine-bench \
    --endpoints http://127.0.0.1:9081 --endpoints http://127.0.0.1:9082 --endpoints http://127.0.0.1:9083 \
    --conns 200 --clients 1000 --total 200000 --key-size 8 \
    --key-space 10 \
    range --consistency l
```
